<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
         <!--TITULO-->
         <title> TREEFLIP | Tienda oficial </title>
    <meta
      name="viewport"
      content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0"
    />
    <link
      rel="stylesheet"
      href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.0/css/bootstrap.min.css"
      integrity="sha384-9gVQ4dYFwwWSjIDZnLEWnxCjeSWFphJiwGPXr1jddIhOegiu1FwO5qRGvFXOdJZ4"
      crossorigin="anonymous"
    />
    <!--BOOTSTRAP CSS-->
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3"
      crossorigin="anonymous"
    />
    <!--BOOTSTRAP Iconos-->
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.8.1/font/bootstrap-icons.css"
    />
    <!--link css-->
    <link rel="stylesheet" href="style.css" />

    <!--FAVICON-->
    <link
      rel="shortcut icon"
      href="./images/favicon.png"
      type="image/x-icon"
    />

    <!--PALABRAS CLAVES-->
    <meta
    name="keywords"
    content="ropa, skate, trasher, treeflip, element, vans">

    <!--DESCRIPCION-->
    <meta
    name="description"
    content=" TREEFLIP. Tienda Online. Entrevistas.
     Informacion campeonatos locales e internacionales.
     Entrevistas.">

  </head>

  <body>
    <nav class="navbar navbar-expand-lg navbar-light bg-light py-3 sticky-top">
      <div class="container">
        <img src="./images/treeflip.jpg" alt="" />
        <a class="navbar-brand" href="#"></a>
        <button
          class="navbar-toggler"
          type="button"
          data-bs-toggle="collapse"
          data-bs-target="#navbarSupportedContent"
          aria-controls="navbarSupportedContent"
          aria-expanded="false"
          aria-label="Toggle navigation"
        >
          <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse" id="navbarSupportedContent">
          <ul class="navbar-nav ms-auto mb-2 mb-lg-0">
            <li class="nav-item">
              <a class="nav-link active" aria-current="page" href="eshop.html"
                >E-SHOP</a
              >
            </li>
            <li class="nav-item">
              <a class="nav-link" href="...">Nosotros</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="...">Inicio</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="...">Galeria</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="./contacto.html">Contacto</a>
            </li>
          </ul>
        </div>
      </div>
    </nav>

    <!--Imagenes -->
    <section class=" ">
      <div
        id="carouselExampleControls"
        class="carousel slide"
        data-bs-ride="carousel"
      >
        <div class="carousel-inner">
          <div class="carousel-item active">
            <img src="images/banner1.jpg" class="d-block w-100" alt="..." />
          </div>
          <div class="carousel-item">
            <img src="images/banner2.jpg" class="d-block w-100" alt="..." />
          </div>
          <div class="carousel-item">
            <img src="..." class="d-block w-100" alt="..." />
          </div>
        </div>
        <button
          class="carousel-control-prev"
          type="button"
          data-bs-target="#carouselExampleControls"
          data-bs-slide="prev"
        >
          <span class="carousel-control-prev-icon" aria-hidden="true"></span>
          <span class="visually-hidden">Previous</span>
        </button>
        <button
          class="carousel-control-next"
          type="button"
          data-bs-target="#carouselExampleControls"
          data-bs-slide="next"
        >
          <span class="carousel-control-next-icon" aria-hidden="true"></span>
          <span class="visually-hidden">Next</span>
        </button>
      </div>
    </section>



    <script>
      document.addEventListener("DOMContentLoaded", () => {

        // PRODUCTOS //
        const baseDeDatos = [
          {
            id: 1,
            nombre: "Remera Violeta",
            precio: 2800,
            imagen: "images/remeraVioleta.jpg",
          },
          {
            id: 2,
            nombre: "Remera Celeste",
            precio: 3000,
            imagen: "images/remeraCeleste.jpg",
          },
          {
            id: 3,
            nombre: "Remera Negra",
            precio: 3500,
            imagen: "images/remeraNegra.jpg",
          },
          {
            id: 4,
            nombre: "Remera Blanca",
            precio: 1500,
            imagen: "images/remeraBlanca.jpg",
          },

          {
            id: 5,
            nombre: "Remera Negra",
            precio: 3500,
            imagen: "images/remeraNegra.jpg",
          },
          {
            id: 6,
            nombre: "Remera Blanca",
            precio: 1500,
            imagen: "images/remeraBlanca.jpg",
          },

        ];

        let carrito = [];
        const divisa = "$";
        const DOMitems = document.querySelector("#items");
        const DOMcarrito = document.querySelector("#carrito");
        const DOMtotal = document.querySelector("#total");
        const DOMbotonVaciar = document.querySelector("#boton-vaciar");
        const miLocalStorage = window.localStorage;

        // FUNCIONES //

        function renderizarProductos() {
          baseDeDatos.forEach((info) => {
            // Estructura
            const miNodo = document.createElement("div");
            miNodo.classList.add("card", "col-sm-4");
            // Body
            const miNodoCardBody = document.createElement("div");
            miNodoCardBody.classList.add("card-body");
            // NOMBRE DEL PRODUCTO //
            const miNodoTitle = document.createElement("h5");
            miNodoTitle.classList.add("card-title");
            miNodoTitle.textContent = info.nombre;
            // Imagen //
            const miNodoImagen = document.createElement("img");
            miNodoImagen.classList.add("img-fluid");
            miNodoImagen.setAttribute("src", info.imagen);
            // PRECIO //
            const miNodoPrecio = document.createElement("p");
            miNodoPrecio.classList.add("card-text");
            miNodoPrecio.textContent = `${info.precio}${divisa}`;
            // BOTON AGREGAR PRODUCTO //
            const miNodoBoton = document.createElement("button");
            miNodoBoton.classList.add("btn", "btn-primary");
            miNodoBoton.textContent = "+";
            miNodoBoton.setAttribute("marcador", info.id);
            miNodoBoton.addEventListener("click", anyadirProductoAlCarrito);
            // Insertamos //
            miNodoCardBody.appendChild(miNodoImagen);
            miNodoCardBody.appendChild(miNodoTitle);
            miNodoCardBody.appendChild(miNodoPrecio);
            miNodoCardBody.appendChild(miNodoBoton);
            miNodo.appendChild(miNodoCardBody);
            DOMitems.appendChild(miNodo);
          });
        }

        function anyadirProductoAlCarrito(evento) {
          carrito.push(evento.target.getAttribute("marcador"));
          renderizarCarrito();
          guardarCarritoEnLocalStorage();
        }

       
        function renderizarCarrito() {
    
          DOMcarrito.textContent = "";

          const carritoSinDuplicados = [...new Set(carrito)];
          
          carritoSinDuplicados.forEach((item) => {
            const miItem = baseDeDatos.filter((itemBaseDatos) => {
              return itemBaseDatos.id === parseInt(item);
            });
             // CUANTAS VECES SE REPITE EL ITEM //
            const numeroUnidadesItem = carrito.reduce((total, itemId) => {
              return itemId === item ? (total += 1) : total;
            }, 0);
            // ITEM CARRITO //
            const miNodo = document.createElement("li");
            miNodo.classList.add("list-group-item", "text-right", "mx-2");
            miNodo.textContent = `${numeroUnidadesItem} x ${miItem[0].nombre} - ${miItem[0].precio}${divisa}`;
           
            // BOTON DE ELIMINAR //
            const miBoton = document.createElement("button");
            miBoton.classList.add("btn", "btn-danger", "mx-5");
            miBoton.textContent = "Eliminar";
            miBoton.style.marginLeft = "1rem";
            miBoton.dataset.item = item;
            miBoton.addEventListener("click", borrarItemCarrito);
     

            miNodo.appendChild(miBoton);
            DOMcarrito.appendChild(miNodo);
          });
          DOMtotal.textContent = calcularTotal();
        }

        function borrarItemCarrito(evento) {
          const id = evento.target.dataset.item;
          carrito = carrito.filter((carritoId) => {
            return carritoId !== id;
          });
          renderizarCarrito();
          guardarCarritoEnLocalStorage();
        }

        function calcularTotal() {
          return carrito
            .reduce((total, item) => {
              const miItem = baseDeDatos.filter((itemBaseDatos) => {
                return itemBaseDatos.id === parseInt(item);
              });
              return total + miItem[0].precio;
            }, 0)
            .toFixed(2);
        }

        function vaciarCarrito() {
          carrito = [];
          renderizarCarrito();
          localStorage.clear();
        }

        function guardarCarritoEnLocalStorage() {
          miLocalStorage.setItem("carrito", JSON.stringify(carrito));
        }

        function cargarCarritoDeLocalStorage() {
          if (miLocalStorage.getItem("carrito") !== null) {
            carrito = JSON.parse(miLocalStorage.getItem("carrito"));
          }
        }

        // Eventos
        DOMbotonVaciar.addEventListener("click", vaciarCarrito);

        // Inicio
        cargarCarritoDeLocalStorage();
        renderizarProductos();
        renderizarCarrito();
      });
    </script>
  </head>
  <body>
    <div class="container">
      <div class="row">
        <!-- Elementos generados a partir del JSON -->
        <main id="items" class="col-sm-8 row"></main>
        <!-- Carrito -->
        <aside class="col-sm-4">
          <h2>Carrito de compras</h2>
          <!-- Elementos del carrito -->
          <ul id="carrito" class="list-group"></ul>
          <hr />
          <!-- Precio total -->
          <p class="text-right">Total: <span id="total"></span> Pesos en total</p>
          <button id="boton-vaciar" class="btn btn-danger">Vaciar</button>
        </aside>
      </div>
    </div>
  </body>
</html>
